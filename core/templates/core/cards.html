{% extends "base.html" %}
{% load static %}

{% block title %}Cartões{% endblock %}

{% block content %}
    <div class="dashboard-layout">
      {% include "partials/nav.html" %}

      <main class="main-content">
        <header class="mobile-header d-flex d-md-none align-items-center justify-content-between px-3">
          <button
            class="btn btn-link text-dark fs-4"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#mobileSidebar"
            aria-controls="mobileSidebar"
            aria-label="Abrir menu"
          >
            <i class="bi bi-list"></i>
          </button>
          <span class="fw-semibold">Cartões</span>
          <span></span>
        </header>

        <div class="container-xxl py-4">
          <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
            <div>
              <p class="text-uppercase text-muted fw-semibold small mb-1">Cartões</p>
              <h1 class="h3 fw-bold mb-1">Gerencie seus cartões</h1>
              <p class="text-muted mb-0">Adicione novos cartões e acompanhe quais estão ativos.</p>
            </div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cardModal">
              <i class="bi bi-plus-lg me-2"></i>Adicionar cartão
            </button>
          </header>

          <section class="card border-0 shadow-sm">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Nome</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for card in cards %}
                      <tr>
                        <td>{{ card.nome }}</td>
                        <td>
                          {% if card.ativo %}
                            <span class="badge text-bg-success">Ativo</span>
                          {% else %}
                            <span class="badge text-bg-secondary">Inativo</span>
                          {% endif %}
                        </td>
                      </tr>
                    {% empty %}
                      <tr>
                        <td colspan="2" class="text-muted">Nenhum cartão cadastrado.</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar" aria-labelledby="mobileSidebarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileSidebarLabel">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'dashboard' %}">
              <i class="bi bi-house"></i>
              <span>Home</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="{% url 'cards' %}">
              <i class="bi bi-credit-card"></i>
              <span>Cartões</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'expenses' %}">
              <i class="bi bi-receipt"></i>
              <span>Lançar contas</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'settings' %}">
              <i class="bi bi-gear"></i>
              <span>Configurações</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'system-logs' %}">
              <i class="bi bi-bug"></i>
              <span>Logs do Sistema</span>
              <span class="badge rounded-pill bg-danger ms-auto logs-pending-badge d-none">0</span>
            </a>
          </li>
          <li class="nav-item mt-3">
            <a class="nav-link text-danger" href="{% url 'logout' %}">
              <i class="bi bi-box-arrow-right"></i>
              <span>Sair</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div class="modal fade" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="cardModalLabel">Novo cartão</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <form method="post" id="cardForm">
              {% csrf_token %}
              <div class="mb-3">
                <label for="{{ card_form.nome.id_for_label }}" class="form-label">Nome</label>
                {{ card_form.nome }}
              </div>
              <div class="form-check form-switch">
                {{ card_form.ativo }}
                <label class="form-check-label" for="{{ card_form.ativo.id_for_label }}">Ativo</label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" form="cardForm" class="btn btn-primary">Salvar</button>
          </div>
        </div>
      </div>
    </div>

{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'core/app.js' %}"></script>
{% endblock %}
